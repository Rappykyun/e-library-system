flowchart TD
    %% ===================================
    %% STYLING
    %% ===================================
    classDef startEnd fill:#ff9500,stroke:#333,stroke-width:2px,color:#fff
    classDef process fill:#555,stroke:#333,stroke-width:2px,color:#fff
    classDef decision fill:#4a90e2,stroke:#333,stroke-width:2px,color:#fff
    classDef error fill:#dc3545,stroke:#333,stroke-width:2px,color:#fff
    classDef spacer stroke:none,fill:none

    %% START
    Start([ðŸ“š START: E-Library System Entry ðŸ“š]):::startEnd

    Start --> Login[ðŸ” User Login ðŸ”]:::process
    Login --> AuthCheck{ðŸ” Is Authentication Valid?}:::decision

    AuthCheck -->|âŒ No| AuthFail[âŒ Login Failed]:::error
    AuthFail --> ForgotPass{ðŸ”‘ Forgot Password?}:::decision
    ForgotPass -->|âœ… Yes| PasswordReset[ðŸ“§ Password Reset Email Sent]:::process
    PasswordReset --> NewPassword[ðŸ”’ Set New Password]:::process --> Login
    ForgotPass -->|âŒ No| Login

    AuthCheck -->|âœ… Yes| EmailVerified{ðŸ“§ Is Email Verified?}:::decision
    EmailVerified -->|âŒ No| SendVerification[ðŸ“¤ Send Verification Email]:::process
    SendVerification --> VerifyEmail[âœ‰ï¸ Click Verification Link]:::process --> EmailVerified
    EmailVerified -->|âœ… Yes| RoleCheck{ðŸ‘¤ Check User Role}:::decision

    %% ROLE-BASED
    RoleCheck -->|ðŸ‘‘ Admin| AdminDash[ðŸ“Š Admin Dashboard]:::process
    RoleCheck -->|ðŸ“š Librarian| LibrarianDash[ðŸ“š Librarian Dashboard]:::process
    RoleCheck -->|ðŸ‘¨â€ðŸ« Faculty| FacultyDash[ðŸŽ“ Faculty Dashboard]:::process
    RoleCheck -->|ðŸŽ“ Student| StudentDash[ðŸ“š Student Dashboard]:::process

    %% COMMON: PROFILE & LOGOUT
    AdminDash --> AdminChoice{ðŸŽ¯ Admin Action?}:::decision
    LibrarianDash --> LibrarianChoice{ðŸŽ¯ Librarian Action?}:::decision
    FacultyDash --> FacultyChoice{ðŸŽ¯ Faculty Action?}:::decision
    StudentDash --> StudentChoice{ðŸŽ¯ Student Action?}:::decision

    %% LOGOUT
    AdminChoice -->|ðŸšª Logout| LogoutProcess[ðŸšª Logout]:::process
    LibrarianChoice -->|ðŸšª Logout| LogoutProcess
    FacultyChoice -->|ðŸšª Logout| LogoutProcess
    StudentChoice -->|ðŸšª Logout| LogoutProcess
    LogoutProcess --> LogoutComplete([ðŸ‘‹ END: Session Ended ðŸ‘‹]):::startEnd

    %% PROFILE MANAGEMENT
    AdminChoice -->|ðŸ‘¤ Profile| ProfileMgmt[ðŸ‘¤ Profile Management]:::process
    LibrarianChoice -->|ðŸ‘¤ Profile| ProfileMgmt
    FacultyChoice -->|ðŸ‘¤ Profile| ProfileMgmt
    StudentChoice -->|ðŸ‘¤ Profile| ProfileMgmt

    ProfileMgmt --> ProfileAction{âš™ï¸ Profile Action?}:::decision
    ProfileAction -->|âœï¸ Edit| EditProfile[ðŸ”§ Edit Profile]:::process --> ProfileMgmt
    ProfileAction -->|ðŸ”’ Password| ChangePassword[ðŸ”’ Change Password]:::process --> ProfileMgmt

    %% ADMIN EXCLUSIVE
    AdminChoice -->|ðŸ‘¥ Users| UserMgmt[ðŸ‘¤ User Management]:::process
    UserMgmt --> UserAction{âš™ï¸ User Action?}:::decision
    UserAction -->|ðŸ‘€ View| ViewUsers[ðŸ“‹ View All Users] --> UserMgmt
    UserAction -->|âž• Add| CreateUser[ðŸ‘¤ Create New User] --> UserMgmt
    UserAction -->|âœï¸ Edit| EditUser[ðŸ”§ Edit User Details] --> UserMgmt
    UserAction -->|ðŸ—‘ï¸ Delete| DeleteUser[âŒ Delete User]:::error --> UserMgmt

    AdminChoice -->|ðŸŽ“ Programs| ProgramMgmt[ðŸ« Program Management]:::process
    ProgramMgmt --> ProgAction{âš™ï¸ Program Action?}:::decision
    ProgAction -->|âž• Add| CreateProg[âž• Create Program] --> ProgramMgmt
    ProgAction -->|âœï¸ Edit| EditProg[âœï¸ Edit Program] --> ProgramMgmt
    ProgAction -->|ðŸ—‘ï¸ Delete| DeleteProg[âŒ Delete Program]:::error --> ProgramMgmt

    AdminChoice -->|ðŸ“š Courses| CourseMgmt[ðŸ“– Course Management]:::process
    CourseMgmt --> CourseAction{âš™ï¸ Course Action?}:::decision
    CourseAction -->|âž• Add| CreateCourse[âž• Create Course] --> CourseMgmt
    CourseAction -->|âœï¸ Edit| EditCourse[âœï¸ Edit Course] --> CourseMgmt
    CourseAction -->|ðŸ—‘ï¸ Delete| DeleteCourse[âŒ Delete Course]:::error --> CourseMgmt

    AdminChoice -->|ðŸ“ˆ Analytics| AdminAnalytics[ðŸ“Š System Analytics]:::process
    AdminAnalytics --> AnalyticsView{ðŸ“‹ View Analytics?}:::decision
    AnalyticsView -->|ðŸ“š Books| BookAnalytics[ðŸ“ˆ Book Statistics] --> AdminAnalytics
    AnalyticsView -->|ðŸ‘¥ Users| UserAnalytics[ðŸ‘¤ User Statistics] --> AdminAnalytics

    %% BOOK & CATEGORY SHARED
    AdminChoice -->|ðŸ“š Books| BookMgmt[ðŸ“– Book Management]:::process
    LibrarianChoice -->|ðŸ“š Books| BookMgmt
    AdminChoice -->|ðŸ·ï¸ Categories| CategoryMgmt[ðŸ“‚ Category Management]:::process
    LibrarianChoice -->|ðŸ·ï¸ Categories| CategoryMgmt

    BookMgmt --> BookAction{âš™ï¸ Book Action?}:::decision
    BookAction -->|âž• Add| CreateBook[âž• Create New Book] --> BookMgmt
    BookAction -->|âœï¸ Edit| EditBook[âœï¸ Edit Book Details] --> BookMgmt
    BookAction -->|ðŸ—‘ï¸ Delete| DeleteBook[ðŸ—‘ï¸ Delete Book]:::error --> BookMgmt

    CategoryMgmt --> CatAction{âš™ï¸ Category Action?}:::decision
    CatAction -->|âž• Add| CreateCat[âž• Create Category] --> CategoryMgmt
    CatAction -->|âœï¸ Edit| EditCat[âœï¸ Edit Category] --> CategoryMgmt
    CatAction -->|ðŸ—‘ï¸ Delete| DeleteCat[ðŸ—‘ï¸ Delete Category]:::error --> CategoryMgmt

    %% FACULTY FLOW
    FacultyChoice -->|ðŸ“š My Courses| CourseShelf[ðŸ“– Course Shelf Management]:::process
    CourseShelf --> ShelfAction{âš™ï¸ Shelf Action?}:::decision
    ShelfAction -->|ðŸ‘€ View| ViewCourseShelf[ðŸ“‹ View Course Resources] --> CourseShelf
    ShelfAction -->|âœï¸ Edit| EditCourseShelf[ðŸ”§ Edit Course Shelf] --> CourseShelf

    FacultyChoice -->|ðŸ“– Browse Books| FacultyBooks[ðŸ“š Browse Library Books]:::process
    FacultyBooks --> FacultyBookAction{ðŸ“– Book Action?}:::decision
    FacultyBookAction -->|ðŸ‘€ View| FacultyViewBook[ðŸ“– View Book Details] --> FacultyBooks
    FacultyBookAction -->|â¬‡ï¸ Download| FacultyDownload[ðŸ“¥ Download Book] --> FacultyBooks

    %% STUDENT FLOW
    StudentChoice -->|ðŸ“– Browse Books| BrowseBooks[ðŸ“š Browse Library Collection]:::process
    BrowseBooks --> BookFilter{ðŸ” Filter Books?}:::decision
    BookFilter -->|ðŸ·ï¸ By Category| FilterCategory[ðŸ“‚ Filter by Category] --> BrowseBooks
    BookFilter -->|ðŸŽ“ By Program| FilterProgram[ðŸ« Filter by Program] --> BrowseBooks
    BookFilter -->|ðŸ” By Search| SearchBooks[ðŸ”Ž Search Books] --> BrowseBooks

    BrowseBooks --> BookDetails[ðŸ“– View Book Details]:::process
    BookDetails --> BookAction2{ðŸ“– Book Action?}:::decision
    BookAction2 -->|ðŸ“– Read| ReadBook[ðŸ‘“ Read Book Online] --> BookDetails
    BookAction2 -->|â¬‡ï¸ Download| DownloadBook[ðŸ“¥ Download Book] --> BookDetails
    BookAction2 -->|ðŸ”– Bookmark| AddBookmark[ðŸ”– Add to Bookmarks] --> BookDetails
    BookAction2 -->|â­ Rate| RateBook[â­ Rate Book] --> BookDetails

    StudentChoice -->|ðŸŽ“ My Courses| MyCourses[ðŸ“š My Enrolled Courses]:::process
    MyCourses --> CourseView{ðŸ“– Course Action?}:::decision
    CourseView -->|ðŸ‘€ View| ViewCourse[ðŸ“‹ View Course Materials] --> MyCourses

    StudentChoice -->|ðŸ”– My Bookmarks| BookmarkMgmt[ðŸ”– Bookmark Management]:::process
    BookmarkMgmt --> BookmarkAction{âš™ï¸ Bookmark Action?}:::decision
    BookmarkAction -->|ðŸ‘€ View| ViewBookmarks[ðŸ“‹ View All Bookmarks] --> BookmarkMgmt
    BookmarkAction -->|ðŸ—‘ï¸ Remove| RemoveBookmark[âŒ Remove Bookmark]:::error --> BookmarkMgmt

    %% APPLY STYLES
    class Start,LogoutComplete startEnd
    class AuthFail,DeleteBook,DeleteCat,DeleteUser,DeleteProg,DeleteCourse,RemoveBookmark error
    class AdminDash,FacultyDash,StudentDash,BookMgmt,CategoryMgmt,UserMgmt,ProgramMgmt,CourseMgmt,LibrarianDash,ProfileMgmt,LogoutProcess process
    class AuthCheck,EmailVerified,RoleCheck,AdminChoice,FacultyChoice,StudentChoice,BookAction,CatAction,LibrarianChoice,BookAction2,BookmarkAction,UserAction,ProgAction,CourseAction,ShelfAction,FacultyBookAction,BookFilter,CourseView,ProfileAction,AnalyticsView,ForgotPass decision
